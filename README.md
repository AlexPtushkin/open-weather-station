![OpenWeatherStation (OWS)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/OpenWeatherStation.png)

**The Open Weather Station (OWS) is an accessible do-it-yourself weather station solution that aims to be affordable, stable, easy to build and tested in the wild. It evolved from other approaches I have been testing and using in the field since late 2012 to this day.**

**Cheers!** 

  ___Eng. Francisco Clariá___

# Weather data
**The information generated by the OWS every minute is the following:**
* wind speed (m/s)
* wind direction (angle)
* wind gust (m/s)
* wind gust direction (angle)
* rain (mm)
* temperature (Cº)
* atmospheric/barometric pressure (Pascal)
* relative humidity (%)
* ambient light (lux)


# Concept
The current implementation is my personal approach to the challenges I have faced during several years of dealing with a lot of unexpected scenarios in the field. Having said that lets understand how this works.

![OWS Concept](https://github.com/panchazo/open-weather-station/blob/master/docs/img/concept.jpg)

An Arduino Uno module reads data from sensors and every minute sends a payload of data via bluetooth to a connected device. The “connected device” is an android smartphone running an app (the app will be ready soon) that receives this information, stores it in memory, displays the data on the screen and if needed it can push the measures to an external service such as wunderground or another custom cloud service either via wifi and/or mobile network - this is one of the primary advantages of using the smartphone. You could also write a Raspberry Pi program to connect to the Arduino via bluetooth to receive the data if the Android app is not suitable for you (at this point the Pi implementation is not in the scope of the project).

Next you can read more about the concepts behind this implementation. Otherwise click here to [jump to the assembly instructions](#arduino-module-assembly).

# Motivation and goals

Before the current approach I have programed and tested other alternatives like: raspberry, pic, arduino + wifi shield, arduino + ethernet shield, arduino + GPRs shield, arduino uno + arduino mega, wifi boards, routers, integrated arduino with sd/microsd modules, etc etc etc and finally the current approach turned out to be the most effective for my goals:

### Affordable 
I tried to make the price as low as possible so it is not a barrier especially for those in countries where electronics are expensive, currently the total cost is around 300USD to 500USD  including sensors, smartphone, housing, etc depending on your location and mostly the smartphone you get

### Compact and unattractive to burglary
Usually the station would end up in a rooftop, tower, etc from someone who allowed me to install the device, being it very compact makes it less attractive to thieves, easier to install, looks better and the elements such as wind, rain, hailstones will make less damage. Also as the arduino module connects via bluetooth the smartphone it is connected to can be placed in a safer place like inside the house to prevent theft.

### Simple and repeatable to build
Some solutions I evaluated before involved a lot of testing, pre configuration or calibration, complex assembly or even difficulty to get the parts for EVERY station i had to build, current OWS approach reduces that headache a lot

### Wifi and cell phone network 
By using an android smartphone I have the possibility to connect via wifi and cell phone network as needed to keep updating external services in the cloud. And even more, if the wifi connection is lost it will automatically switch to the cell network without any hassle, no AT commands and weird handshakes to achieve a simple HTTP connection…

### Power loss 
Electricity goes away many times, specially during storms: the Arduino module can stay on for around a day with a 5000mAh power bank and the cellphone has already batteries on it, so, depending on the model it will work probably for a day or so too, while still being able to send data if the cell network is working (wifi will probably will die in this scenario)


### Software stability
Arduino module software is really robust, if it reboots it will restart from scratch without any stuff hanging around, I even added a watchdog to make it reboot if for some reason some process takes more than 4 seconds. In this matter I have tested over long periods of time the sd shields, ethernet, wifi and GPRs shields and ALL of them hang after some weeks or even less, requiring a manual reset and in the case of the SD/memory I even needed to extract the card and insert it back… In the other hand I found after long periods of testing in the wild that Android is rock solid and smartphones (like a moto E/moto G) endurance is amazing, coping with temperatures below 0Cº and over 50Cº, experiencing repeated power loss (until battery drained completely) as well as connectivity loss without hanging at all.

### Data visualization and diagnosis
The app allows to both serve as an offline visualization screen or when performing a new installation or maintenance in the field to see what is going on. Sometimes I need to make sure the OWS is working properly especially during a new installation or maintenance, and most of the time I perform this task alone, in a tower or rooftop where its not suitable to take a laptop with me, therefore having the Arduino module connected via bluetooth allows easier diagnosis and with the app running on the smartphone visualization is very easy, comfortable and I don’t need to get the data to the external service to diagnose if its working… its all in the screen

### Data log and storage 
As mentioned before adding memory to the arduino module was one of the things that increased maintenance requirements for the solution as SD hangs and EEPROM wears out, not to mention that the storage and retrieval of large amounts of data (many days of 1 sample per minute) is a slow and complex process for arduino to properly handle. For this reason the arduino module stores samples for about 15 minutes (configurable) which is the time that eventually android may take to restart if it was off for some reason, and then the android app handles data logging, visualization and upload in a more efficient and stable way while at the same time allowing to store larger periods of time.

### Reduced maintenance 
It all comes down to reducing implementation and maintenance as much as I could since most stations I installed are located in remote places, where I need to request access to the owner and everything has to be done as fast as possible

## Why arduino?
The core reasons I decided to use Arduino are:
* widespread adoption
* huge community 
* documentation
* examples everywhere
* available libraries to achieve common tasks
* low price 
* available in many countries
* powering the arduino is easy and convenient (e.g. directly from USB power bank)
* feeding sensors is very easy as it has available 3.3v and 5v regulated outputs that can feed up to 150mA (from 3.3v) or 400mA (from 5v) when connected via USB
* power drain per pin allows 20mA with a 40mA maximum and 200mA in total 
*Bottom line, I think that it make it easier if you want to change, extend or improve the current arduino module solution*

# Android App
Arduino module connects to an android app via bluetooth, this app will be released in the upcoming months and will be open source too. Please take a look back around Febrary/March 2018.

# Connecting other devices
Since the sensing Arduino module transmits the data every minute you could build your own solution that connects to it via bluetooth and process the data as you wish instead of using the proposed android app. For instance a Raspberry implementation could be a great alternative to achieve this, or you could write a Windows 10 application and connect to the module with your computer, just to mention couple examples. This alternatives however are outside the scope of the current project for the time being.

# Arduino module assembly
Next I depict some guidelines so you can build your own module step by step.

![OWS assembly](https://github.com/panchazo/open-weather-station/blob/master/docs/img/assembly_teaser.jpg)

## Schematics diagram

![OWS schematics](https://github.com/panchazo/open-weather-station/blob/master/docs/img/circuit_diagram.png)

## List of materials

The following is the full list of materials needed to implement the station with all its features. In the next sections I will instruct how to assembly the OWS arduino module considering the ideal scenario with all the components, however the module will still work if you don’t connect all sensors, so, if you only want to measure wind speed for instance you can simply ignore the rain, light or pressure sensors.

| Item                                                                                                                                | Quantity | Use                                   |
|-------------------------------------------------------------------------------------------------------------------------------------|----------|---------------------------------------|
| Red or Green led                                                                                                                    | 1        | status light                          |
| 18 kOhm resistor                                                                                                                    | 2        | anemometer and rain debounce circuit  |
| 12 kOhm resistor                                                                                                                    | 2        | anemometer and rain debounce circuit  |
| 10 kOhm resistor                                                                                                                    | 1        | windvane                              |
| 220 Ohm resistor                                                                                                                    | 1        | status led                            |
| 2.2 Kohm resistor                                                                                                                   | 1        | bluetooth                             |
| 1 kOhm resistor                                                                                                                     | 1        | bluetooth                             |
| dual rj11 jack [(example)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/rj11_socket.jpg)                                                                                                                     | 1        | anemometer, wind vane and rain cables |
| diode                                                                                                                               | 2        | anemometer and rain debounce circuit  |
| 1μF capacitor                                                                                                                        | 2        | anemometer and rain debounce circuit  |
| NPN transistor                                                                                                                      | 1        | bluetooth                             |
| Single side copper PCB 5cm x 7cm or bigger [(example)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/pcb_single_side_copper.jpg)                                                                                          | 1        | pcb shield to connect components      |
| Arduino Uno R3                                                                                                                     | 1        | procesing unit                        |
| BHT1750 Light sensor                                                                                                                | 1        | llight                                |
| BME280 pressure, temperature, humidity sensor                                                                                       | 1        | pressure, temperature, humidity       |
| HC05 Bluetooth module                                                                                                               | 1        | bluetooth communications              |
| WS 1080 replacement anemometer sensor  [(example)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/ws1080_anemometer.jpg)                                                                                              | 1        | wind speed                            |
| WS 1080 replacement wind vane sensor [(example)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/ws1080_windvane.jpg)                                                                                               | 1        | wind direction angle                  |
| WS 1080 replacement rain gauge sensor [(example)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/ws1080_rain_gauge.jpg)                                                                                               | 1        | rain                                  |
| standard header pins pack [(example)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/header_pins.jpg)                                                                                                           | 1        | connecting the wires                  |
| female to female jumper wires pack [(example)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/female_female_jumper_wires.jpg)                                                                                                 | 1        | wiring sensors                        |
| portable power bank charger 5000mAh or similar that operates without user intervention - must NOT need a button push for it to work | 1        | OWS power backup for Arduino          |
| 15x10x10cm or similar, outdoor plastic housing                                                                                      | 1        | protect the OWS module from elements  |
| 110/220v dual usb wall socket charger module [(example)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/dual_usb_wall_socket_charger_module.jpg)                                                                                       | 1        | OWS usb power source                  |
| 110v/220v power cable [(example)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/110-220_power_cable.jpg)                                                                                                              | 1        | power                                 |
| WS 1080 anemometer and wind vane plastic support [(example)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/ws1080_anemometer_windvane_support.jpg)                                                                                                                    | 1        | support for wind sensors                          |
| WS 1080 rain gauge plastic  support [(example)](https://github.com/panchazo/open-weather-station/blob/master/docs/img/ws1080_rain_gauge_support.jpg)                                                                                                                   | 1        | support for rain sensors                          |
***
**Please recall that I have included all components needed for a full OWS Arduino module assembly, you can purcharse only those related to the sensors you want to implement or even build your own if you want to reduce some costs (like the wind and rain plastic supports). The Arduino code implementation will still work if only some sensors are connected.**
***

## PCB board and assembly code list

![OWS pcb](https://github.com/panchazo/open-weather-station/blob/master/docs/img/pcb-components.png)

| Item              | assembly code |
|-------------------|---------------|
| 18 kOhm resistor  | R6, R2        |
| 12 kOhm resistor  | R8, R4        |
| 10 kOhm resistor  | R9            |
| 220 Ohm resistor  | R10           |
| 2.2 Kohm resistor | R11           |
| 1 kOhm resistor   | R12           |
| diode             | D1, D2        |
| 1μFcapacitor      | C1, C2        |

## PCB Etching

There are several techniques to produce the board circuit, from manually drawing the circuit with a permanent marker to a tone transfer method (https://www.youtube.com/watch?v=QQupRXEqOz4). Since there are plenty of videos and tutorials on how to do it I will let you choose the method of your preference. In case you go for the tone transfer method, recall it’s very important to use a photo quality glossy paper.

Any case you can use [this PDF sheet](https://github.com/panchazo/open-weather-station/blob/master/docs/pcb%20printing%20sheet.pdf) or use the next copper circuit image to produce the pcb. Both have a size reference in the left side (50mm) you can use to make sure the printer did not alter its original dimensions and recall also that the circuit has already been mirrored for your convenience. 

![OWS pcb](https://github.com/panchazo/open-weather-station/blob/master/docs/img/pcb_copper_mirror.png)

## Soldering, wiring & powering
TODO

* Etch PCB
* Drill PCB
* Solder surface components
* Wire and connect sensors
  * Wind speed, wind direction and rain
    * RJ11 jack
  * Pressure, temperature & humidity
    * BME280
  * Light
    * BHT1750
  * Bluetooth
    * HC05
* Powering arduino module
* Housing recommendations


## Bluetooth connection & testing
TODO
* Loading OWS Arduino Module software
* PC
* Cellphone



